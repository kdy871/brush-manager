<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¸ŒëŸ¬ì‰¬ ì´ë ¥ ì¡°íšŒ (í™•ì¸ìš©)</title>
    <style>
        /* ìŠ¤íƒ€ì¼ì€ ê¸°ì¡´ê³¼ ë™ì¼í•˜ë˜, í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        :root {
            --yard-bg: #f3e5f5; --yard-header: #9c27b0;
            --boiler-bg: #fff8e1; --boiler-header: #fbc02d;
            --btn-base: #fff; --btn-hover: #e3f2fd;
        }
        body { font-family: 'Malgun Gothic', sans-serif; padding: 20px; background: #fafafa; }
        h2 { text-align: center; margin-bottom: 10px; }
        .unit-selector { display: flex; justify-content: center; gap: 10px; margin-bottom: 20px; }
        .unit-btn { padding: 10px 30px; font-size: 18px; border: 2px solid #333; background: #fff; cursor: pointer; border-radius: 8px; font-weight: bold; }
        .unit-btn.active { background: #333; color: #fff; }
        .main-container { max-width: 1400px; margin: 0 auto; display: flex; flex-direction: column; gap: 20px; }
        .direction-section { border: 1px solid #ddd; border-radius: 10px; overflow: hidden; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .section-header { padding: 10px; text-align: center; font-weight: bold; font-size: 1.2rem; color: white; }
        .yard-theme .section-header { background-color: var(--yard-header); }
        .yard-theme .content { background-color: var(--yard-bg); }
        .boiler-theme .section-header { background-color: var(--boiler-header); }
        .boiler-theme .content { background-color: var(--boiler-bg); }
        .content { display: flex; padding: 15px; gap: 20px; justify-content: center; flex-wrap: wrap; }
        .equipment-part { flex: 1; min-width: 300px; }
        .part-title { text-align: center; font-weight: bold; margin-bottom: 10px; color: #444; border-bottom: 2px solid rgba(0,0,0,0.1); padding-bottom: 5px; }
        
        /* ê·¸ë¦¬ë“œ ë° ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .grid-wrapper { display: grid; grid-template-columns: repeat(8, 1fr); gap: 10px; }
        
        .brush-btn { 
            background-color: var(--btn-base); 
            border: 1px solid #ccc; 
            border-radius: 4px; 
            padding: 5px 2px; /* íŒ¨ë”© ì‚´ì§ ì¤„ì„ */
            cursor: pointer; 
            text-align: center; 
            transition: all 0.2s; 
            height: 60px; /* ë†’ì´ë¥¼ ì‚´ì§ í‚¤ì›€ (ê¸€ì”¨ 2ì¤„ ë“¤ì–´ê°€ì•¼ í•¨) */
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
        }
        .brush-btn:hover { background-color: var(--btn-hover); border-color: #2196f3; }
        
        /* ë²„íŠ¼ ë‚´ë¶€ í…ìŠ¤íŠ¸ ìŠ¤íƒ€ì¼ */
        .btn-code { font-size: 12px; font-weight: bold; margin-bottom: 4px; color: #333; }
        .btn-count { font-size: 11px; color: #e03131; font-weight: bold; } /* ë¹¨ê°„ìƒ‰ ëˆ„ì  íšŸìˆ˜ */
        
        /* êµ¬ë¶„ì„  */
        .grid-wrapper > div:nth-child(8n+4) { position: relative; }
        .grid-wrapper > div:nth-child(8n+4)::after { content: ""; position: absolute; right: -6px; top: 5px; bottom: 5px; width: 2px; background-color: #d1d1d1; border-radius: 2px; }

        /* ë¡œë”© í‘œì‹œ */
        #loadingMsg { text-align: center; color: #666; font-size: 0.9rem; margin-bottom: 10px; }
    </style>
</head>
<body>

    <h2>ğŸ” ë¸ŒëŸ¬ì‰¬ ì´ë ¥ ì¡°íšŒ (í™•ì¸ìš©)</h2>
    <div id="loadingMsg">ë°ì´í„° ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    
    <div class="unit-selector">
        <button class="unit-btn active" onclick="setUnit(3)">#3í˜¸ê¸°</button>
        <button class="unit-btn" onclick="setUnit(4)">#4í˜¸ê¸°</button>
    </div>

    <div class="main-container">
        <div class="direction-section yard-theme">
            <div class="section-header">YARD ë°©í–¥</div>
            <div class="content">
                <div class="equipment-part"><div class="part-title">COLLECTOR (C/Y)</div><div class="grid-wrapper" id="grid-CY"></div></div>
                <div class="equipment-part"><div class="part-title">TURBINE (T/Y)</div><div class="grid-wrapper" id="grid-TY"></div></div>
            </div>
        </div>
        <div class="direction-section boiler-theme">
            <div class="section-header">BOILER ë°©í–¥</div>
            <div class="content">
                <div class="equipment-part"><div class="part-title">COLLECTOR (C/B)</div><div class="grid-wrapper" id="grid-CB"></div></div>
                <div class="equipment-part"><div class="part-title">TURBINE (T/B)</div><div class="grid-wrapper" id="grid-TB"></div></div>
            </div>
        </div>
    </div>

    <script>
        // =========================================================================
        // [1] êµ¬ê¸€ ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ ì£¼ì†Œ (í†µê³„ ë°ì´í„° ë°›ì•„ì˜¤ê¸°ìš©) - í•„ìˆ˜ ì…ë ¥!
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyn5VaSQ0Fd21EgY5OcHQRPc7-oRpwQTiGzoaJlXnWeNCPPpM3CWUynSGPnjYKb5LO7jg/exec"; 
        
        // [2] ëŒ€ì‹œë³´ë“œ ì£¼ì†Œ (ê·¸ë˜í”„ ë³´ëŸ¬ ê°€ê¸°ìš©) - í•„ìˆ˜ ì…ë ¥!
        const DASHBOARD_URL = "https://kdy871.github.io/brush-manager/dashboard.html"; 
        // =========================================================================

        let currentUnit = 3;
        let globalStats = []; // ë°›ì•„ì˜¨ í†µê³„ ë°ì´í„°ë¥¼ ì €ì¥í•  ê³³

        const levelMapping = { 4: { left: 4, right: 8 }, 3: { left: 3, right: 7 }, 2: { left: 2, right: 6 }, 1: { left: 1, right: 5 } };
        const cols = ['A', 'B', 'C', 'D'];

        // ì‹œì‘í•˜ìë§ˆì ë°ì´í„°ë¶€í„° ê°€ì ¸ì˜µë‹ˆë‹¤
        window.onload = function() {
            fetchStats();
        };

        // í†µê³„ ë°ì´í„° ê°€ì ¸ì˜¤ê¸° í•¨ìˆ˜
        function fetchStats() {
            const msg = document.getElementById('loadingMsg');
            msg.style.display = 'block';

            fetch(`${SCRIPT_URL}?action=getStats`)
            .then(res => res.json())
            .then(data => {
                globalStats = data; // ë°ì´í„° ì €ì¥
                msg.style.display = 'none';
                init(); // í™”ë©´ ê·¸ë¦¬ê¸° ì‹œì‘
            })
            .catch(err => {
                msg.innerText = "ë°ì´í„° ë¡œë”© ì‹¤íŒ¨ (ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”)";
                console.error(err);
                // ì—ëŸ¬ê°€ ë‚˜ë„ ì¼ë‹¨ í™”ë©´ì€ ê·¸ë¦½ë‹ˆë‹¤ (ì¹´ìš´íŠ¸ ì—†ì´)
                init();
            });
        }

        function createGrid(elementId, prefix, orderList) {
            const container = document.getElementById(elementId);
            container.innerHTML = ""; 
            orderList.forEach(level => {
                const map = levelMapping[level];
                cols.forEach(col => createBtn(container, prefix, map.left, col));
                cols.forEach(col => createBtn(container, prefix, map.right, col));
            });
        }

        function createBtn(container, prefix, num, col) {
            const btnCode = `${prefix}-${num}${col}`; // ì˜ˆ: C/Y-4A
            const btn = document.createElement('div');
            btn.className = 'brush-btn';
            
            // [í•µì‹¬] í˜„ì¬ í˜¸ê¸°ì™€ ìœ„ì¹˜ì— ë§ëŠ” ì¹´ìš´íŠ¸ ì°¾ê¸°
            // ë°ì´í„° í˜•ì‹: { unit: "3í˜¸ê¸°", location: "C/Y-4A", count: 5 ... }
            const myStat = globalStats.find(item => 
                item.unit == `${currentUnit}í˜¸ê¸°` && item.location == btnCode
            );
            
            // ì¹´ìš´íŠ¸ê°€ ìˆìœ¼ë©´ "ëˆ„ì  NíšŒ", ì—†ìœ¼ë©´ "-"
            const countText = myStat ? `ëˆ„ì  ${myStat.count}íšŒ` : "-";
            // ë§ì´ êµì²´ëœ ê²ƒ(5íšŒ ì´ìƒ)ì€ ë” ì§„í•˜ê²Œ í‘œì‹œ (ì„ íƒì‚¬í•­)
            const countColor = (myStat && myStat.count >= 5) ? "#d90429" : "#e03131"; 

            btn.innerHTML = `
                <div class="btn-code">${btnCode}</div>
                <div class="btn-count" style="color:${countColor}">${countText}</div>
            `;

            // í´ë¦­ ì‹œ ëŒ€ì‹œë³´ë“œ ì´ë™
            btn.onclick = function() {
                const targetUrl = `${DASHBOARD_URL}?unit=${encodeURIComponent(currentUnit + 'í˜¸ê¸°')}&location=${encodeURIComponent(btnCode)}`;
                window.location.href = targetUrl;
            };
            container.appendChild(btn);
        }

        function init() {
            const yardOrder = [4, 3, 2, 1];
            const boilerOrder = [1, 2, 3, 4];
            
            // ë²„íŠ¼ì„ ê·¸ë¦´ ë•Œë§ˆë‹¤ globalStats ë°ì´í„°ë¥¼ ì°¸ê³ í•´ì„œ ìˆ«ìë¥¼ ë„£ìŠµë‹ˆë‹¤.
            createGrid('grid-CY', 'C/Y', yardOrder);
            createGrid('grid-TY', 'T/Y', yardOrder);
            createGrid('grid-CB', 'C/B', boilerOrder);
            createGrid('grid-TB', 'T/B', boilerOrder);
        }

        function setUnit(unit) {
            currentUnit = unit;
            document.querySelectorAll('.unit-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            
            // í˜¸ê¸°ë¥¼ ë°”ê¾¸ë©´ í™”ë©´ì„ ë‹¤ì‹œ ê·¸ë ¤ì„œ (3í˜¸ê¸°ìš©/4í˜¸ê¸°ìš©) ìˆ«ìë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
            init();
        }
    </script>
</body>
</html>